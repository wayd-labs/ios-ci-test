dependencies:
  cache_directories:
    - build
  pre:
     - brew upgrade xctool
#    - sudo gem install cocoapods --version 0.38.2
#    # CocoaPods sometimes has issues using caches
#    # between different versions of CocoaPods.
#    - pod setup
#    - pod install

general:
  build_dir: ios-ci-test

machine:
  environment:
    XCODE_WORKSPACE: 'ios-ci-test.xcworkspace'
    XCODE_SCHEME: ios-ci-test
    APPNAME: ios-ci-test
    BUILD_DIR: build
    LANG: en_US.UTF-8
  xcode:
    version: "6.4"

test:
  override:
    - xctool
      -reporter pretty
      -reporter junit:$CIRCLE_TEST_REPORTS/xcode/results.xml
      -reporter plain:$CIRCLE_ARTIFACTS/xctool.log
      -destination 'platform=iOS Simulator,name=iPhone 6,OS=latest'
      -sdk iphonesimulator
      -workspace "$XCODE_WORKSPACE"
      -scheme "$XCODE_SCHEME"
      -configuration Debug
      -derivedDataPath "$BUILD_DIR"
      build
    - sh ../uiautomation.sh ../uiautomation/tests.js ru_RU "iPhone 6 (8.4 Simulator)"

deployment:
  staging:
    branch:  /feature\/.*/
    commands: 
      - sh ../scripts/add-key.sh
      - sh ../scripts/crashlytics.sh
      - sh ../scripts/remove-key.sh
